# üá∑üá∫ Zabbix 7.4 –≤ Docker + PSK –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤ üê≥üîí

**UI FQDN:** `yourdomain.com`  

---

## üì¶ –°–æ—Å—Ç–∞–≤ –ø—Ä–æ–µ–∫—Ç–∞

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL 17 (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
- **Zabbix Server:** `zabbix/zabbix-server-pgsql:alpine-7.4-latest`
- **Zabbix Web:** `zabbix/zabbix-web-nginx-pgsql:alpine-7.4-latest`
- **Nginx:** TLS-—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è
- **PSK –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤:** –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á (PSK)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

   ```shell
   cp .env.example .env
   # –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–î –∏ —Å–µ—Ä–≤–µ—Ä–∞ –≤ .env
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ PSK –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤:**

   ```shell
   openssl rand -hex 32 > /opt/zabbix/ssl/zabbix_agentd.psk
   # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π –ø—É—Ç—å, –Ω–æ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª!
   ```

3. **–ó–∞–ø—É—Å–∫ —Å—Ç–µ–∫–∞:**

   ```shell
   docker compose up -d
   ```

4. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**  
   [https://yourdomain.com](https://yourdomain.com)

---

## üñ•Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ö–æ—Å—Ç–∞ Zabbix (PSK)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö–æ—Å—Ç–∞ –≤ Zabbix ‚Üí **Encryption**:

- Connections to host: **PSK**
- PSK identity: —Å—Ç—Ä–æ–∫–∞-–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `zabbix-psk`)
- PSK: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/opt/zabbix/ssl/zabbix_agentd.psk` (–∏–ª–∏ –≤–∞—à–µ–≥–æ –ø—É—Ç–∏)

---

## üêß –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞ –∞–≥–µ–Ω—Ç–∞ (Linux, PSK)

```ini
Server=<IP_–∏–ª–∏_FQDN_—Å–µ—Ä–≤–µ—Ä–∞_Zabbix>
ServerActive=<IP_–∏–ª–∏_FQDN_—Å–µ—Ä–≤–µ—Ä–∞_Zabbix>
TLSConnect=psk
TLSAccept=psk
TLSPSKIdentity=zabbix-psk
TLSPSKFile=/etc/zabbix/zabbix_agentd.psk
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –∏ PSK-—Ñ–∞–π–ª—ã
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ `chmod 600` –Ω–∞ PSK-—Ñ–∞–π–ª—ã
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–π—Ç–µ PSK –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –æ–¥–Ω—É —Å–µ—Ç—å `zbx-net`
- –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Postgres –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è volume `zbx-pgdata`
- PSK-—Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```
   cp .env.example .env
   # –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–î –∏ —Å–µ—Ä–≤–µ—Ä–∞ –≤ .env
   ```

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:**

   ```shell
   # 1. –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
   openssl genrsa -out secrets/server/server.key.pem 2048
   chmod 600 secrets/server/server.key.pem

   # 2. –°–æ–∑–¥–∞–µ–º CSR (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞)
   openssl req -new -key secrets/server/server.key.pem \
     -out tls/server.csr.pem \
     -config tls/openssl.conf

   # –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –æ—Ç CA:
   cp server.crt.pem secrets/server/server.crt.pem
   cat server.crt.pem chain.pem > secrets/server/server.fullchain.pem
   ```

   *–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ PFX:*

   ```shell
   # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ PFX
   openssl pkcs12 -in server.pfx -nocerts -nodes -out secrets/server/server.key.pem
   openssl pkcs12 -in server.pfx -clcerts -nokeys -out secrets/server/server.crt.pem
   openssl pkcs12 -in server.pfx -cacerts -nokeys -out chain.pem
   cat secrets/server/server.crt.pem chain.pem > secrets/server/server.fullchain.pem
   chmod 600 secrets/server/server.key.pem
   ```

3. **–°–æ–∑–¥–∞–π—Ç–µ PSK –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤:**
   ```bash
   openssl rand -hex 32 > /opt/zabbix/ssl/zabbix_agentd.psk
   # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π –ø—É—Ç—å, –Ω–æ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª!
   ```

4. **–ó–∞–ø—É—Å–∫ —Å—Ç–µ–∫–∞:**
   ```bash
   docker compose up -d
   ```

5. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**  
   [https://yourdomain.com](https://yourdomain.com)

---

## üñ•Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ö–æ—Å—Ç–∞ Zabbix (PSK)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö–æ—Å—Ç–∞ –≤ Zabbix ‚Üí **Encryption**:
- Connections to host: **PSK**
- PSK identity: —Å—Ç—Ä–æ–∫–∞-–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `zabbix-psk`)
- PSK: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/opt/zabbix/ssl/zabbix_agentd.psk` (–∏–ª–∏ –≤–∞—à–µ–≥–æ –ø—É—Ç–∏)

---

## üêß –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞ –∞–≥–µ–Ω—Ç–∞ (Linux, PSK)

```
Server=<IP_–∏–ª–∏_FQDN_—Å–µ—Ä–≤–µ—Ä–∞_Zabbix>
ServerActive=<IP_–∏–ª–∏_FQDN_—Å–µ—Ä–≤–µ—Ä–∞_Zabbix>
TLSConnect=psk
TLSAccept=psk
TLSPSKIdentity=zabbix-psk
TLSPSKFile=/etc/zabbix/zabbix_agentd.psk
```

---



## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `secrets/`, `.env`, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –∏ PSK-—Ñ–∞–π–ª—ã
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ `chmod 600` –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –∏ PSK
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–π—Ç–µ PSK –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –•—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –∫–ª—é—á–∏ –≤ –ø–∞–ø–∫–µ `secrets/` —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è TLS-—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏ –≤ Nginx

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –æ–¥–Ω—É —Å–µ—Ç—å `zbx-net`
- –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Postgres –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è volume `zbx-pgdata`
- PSK-—Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
